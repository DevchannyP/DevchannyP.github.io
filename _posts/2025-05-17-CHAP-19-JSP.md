---
layout: post
title: "CHAP 3-1. SQL ë³´ì•ˆ ê¸°ë²•"
date: 2025-05-17
categories: [backend, language, jsp]
tags: [backend, language, jsp]
thumbnail: /assets/img/post-thumbnails/intro19.png
author: Devchanny
---


# ** ğŸ“ŒSQL ë³´ì•ˆ ê¸°ë²•**

> SQL Injectionì„ ì™„ë²½íˆ ì°¨ë‹¨í•˜ëŠ” PreparedStatement ê¸°ë²•ê³¼
> 
> 
> ì„œë²„ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ë³‘í–‰í•˜ëŠ” ì‹¤ë¬´ + ë©´ì ‘ ëŒ€ë¹„ìš© ë³´ì•ˆ ì „ëµ ì •ë¦¬
> 

---

## ğŸ§© ëª©ì°¨

1. SQL Injectionì´ë€?
2. ê³µê²© ì˜ˆì‹œ ë° ìœ„í—˜ì„±
3. ë°©ì§€ ë°©ë²•: PreparedStatement
4. ìœ íš¨ì„± ê²€ì‚¬ ë³‘í–‰ ì²˜ë¦¬
5. ì‹¤ì „ ì˜ˆì œ (ì·¨ì•½í•œ ì½”ë“œ â†’ ì•ˆì „í•œ ì½”ë“œ)
6. ì‹¤ë¬´ ë³´ì•ˆ íŒ
7. ê¸°ìˆ  ë©´ì ‘ ëŒ€ë¹„ í•µì‹¬ ìš”ì•½
8. ë§ˆë¬´ë¦¬ ìš”ì•½ + Notion ì‘ì„± íŒ

---

## âœ… 1. SQL Injectionì´ë€?

| í•­ëª© | ì„¤ëª… |
| --- | --- |
| ì •ì˜ | ì‚¬ìš©ìê°€ ì…ë ¥ì°½ì— ì•…ì˜ì ì¸ SQLì„ ì…ë ¥í•´ DBë¥¼ ì¡°ì‘í•˜ëŠ” ê³µê²© |
| ê²°ê³¼ | ë¡œê·¸ì¸ ìš°íšŒ, ë°ì´í„° ì‚­ì œ, ëª¨ë“  í…Œì´ë¸” ì—´ëŒ ë“± ì¹˜ëª…ì ì¸ í”¼í•´ ë°œìƒ ê°€ëŠ¥ |
| ìœ„í—˜ë„ | ğŸ”´ ë§¤ìš° ë†’ìŒ â†’ ë°˜ë“œì‹œ ë°©ì–´ ì½”ë”© í•„ìš” |

---

## âœ… 2. ê³µê²© ì˜ˆì‹œ ë° ìœ„í—˜ì„±

```sql
-- ì‚¬ìš©ìê°€ ì…ë ¥í•œ ID: ' OR 1=1 --
SELECT * FROM members WHERE userid='' OR 1=1 --' AND userpw='...'
```

| ë¬¸ì œì  | ì„¤ëª… |
| --- | --- |
| `' OR 1=1 --` | í•­ìƒ trueì¸ ì¡°ê±´ìœ¼ë¡œ ë¡œê·¸ì¸ ìš°íšŒ ê°€ëŠ¥ |
| `--` | ë’¤ì˜ ì¡°ê±´ë¬¸ ë¬´ì‹œ (ì£¼ì„ ì²˜ë¦¬ë¨) |
| ğŸš¨ ê²°ê³¼ | ê´€ë¦¬ì ê³„ì • ì—†ì´ ë¡œê·¸ì¸ ì„±ê³µ, DB ì „ì œ ì¡°íšŒ/ë³€ì¡° ê°€ëŠ¥ |

---

## âœ… 3. ë°©ì§€ ë°©ë²•: PreparedStatement ì‚¬ìš©

| ë°©ë²• | ì„¤ëª… |
| --- | --- |
| PreparedStatement | SQLì— ë³€ìˆ˜ ìë¦¬(?)ë¥¼ ë‘ê³ , ê°’ì€ ë”°ë¡œ ì „ë‹¬í•˜ëŠ” ë°©ì‹ |
| ì¥ì  | ë‚´ë¶€ì ìœ¼ë¡œ SQLê³¼ ê°’ì„ ë¶„ë¦¬ â†’ SQL Injection ë¶ˆê°€ëŠ¥ |
| ë°˜ë“œì‹œ ì‚¬ìš© | ëª¨ë“  SQL ì…ë ¥ êµ¬ë¬¸ì—ì„œ í•„ìˆ˜ë¡œ ì ìš©í•´ì•¼ í•¨ |

---

### ğŸ” ì•ˆì „í•œ PreparedStatement ì˜ˆì œ

```java
String sql = "SELECT * FROM members WHERE userid=? AND userpw=?";
PreparedStatement ps = conn.prepareStatement(sql);
ps.setString(1, userid);  // ê°’ë§Œ ë°”ì¸ë”©
ps.setString(2, userpw);  // SQL êµ¬ì¡°ëŠ” ê±´ë“œë¦¬ì§€ ì•ŠìŒ
```

---

### ğŸ”´ ì ˆëŒ€ ì‚¬ìš©í•˜ë©´ ì•ˆ ë˜ëŠ” ë°©ì‹ (ì·¨ì•½)

```java
// ìœ„í—˜! ì§ì ‘ ë¬¸ìì—´ ì—°ê²°
String sql = "SELECT * FROM members WHERE userid='" + userid + "' AND userpw='" + userpw + "'";
```

---

## âœ… 4. ìœ íš¨ì„± ê²€ì‚¬ ë³‘í–‰ ì²˜ë¦¬

| ìœ„ì¹˜ | ì˜ˆì‹œ | ì„¤ëª… |
| --- | --- | --- |
| ğŸ’» JavaScript | `onsubmit()`ì—ì„œ ë¹ˆì¹¸ í™•ì¸ | ë¹ ë¥´ê³  ì‚¬ìš©ì ì¹œí™”ì  |
| ğŸ–¥ï¸ Servlet | `if(id == null |  |
| ë³‘í–‰ ì´ìœ  | JSëŠ” êº¼ì§ˆ ìˆ˜ ìˆìŒ â†’ ì„œë²„ ìœ íš¨ì„± ê²€ì‚¬ëŠ” í•„ìˆ˜! |  |

---

## âœ… 5. ì‹¤ì „ ì˜ˆì œ (ë¡œê·¸ì¸ ì²˜ë¦¬ ê¸°ì¤€)

---

### ğŸ“„ ì•ˆì „í•œ LoginServlet.java

```java
protected void doPost(HttpServletRequest req, HttpServletResponse resp)
    throws ServletException, IOException {

  req.setCharacterEncoding("UTF-8");
  String userid = req.getParameter("userid");
  String userpw = req.getParameter("userpw");

  // ì„œë²„ ì¸¡ ìœ íš¨ì„± ê²€ì‚¬
  if (userid == null || userid.trim().equals("") || userpw == null || userpw.trim().equals("")) {
    PrintWriter out = resp.getWriter();
    out.println("<script>alert('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•˜ì„¸ìš”'); history.back();</script>");
    return;
  }

  // DB ë¡œê·¸ì¸ ì²˜ë¦¬
  MemberDAO dao = new MemberDAO();
  boolean isValid = dao.login(userid, userpw);

  if (isValid) {
    req.getSession().setAttribute("loginId", userid);
    resp.sendRedirect("main.jsp");
  } else {
    PrintWriter out = resp.getWriter();
    out.println("<script>alert('ë¡œê·¸ì¸ ì‹¤íŒ¨'); location.href='login.jsp';</script>");
  }
}
```

---

### ğŸ“„ MemberDAO.java (PreparedStatement ì ìš©)

```java
public boolean login(String id, String pw) {
  boolean result = false;
  try {
    Connection conn = DB.getConnection();
    String sql = "SELECT * FROM members WHERE userid=? AND userpw=?";
    PreparedStatement ps = conn.prepareStatement(sql);
    ps.setString(1, id);
    ps.setString(2, pw);
    ResultSet rs = ps.executeQuery();
    result = rs.next(); // ê²°ê³¼ê°€ ì¡´ì¬í•˜ë©´ ë¡œê·¸ì¸ ì„±ê³µ
    conn.close();
  } catch(Exception e) {
    e.printStackTrace();
  }
  return result;
}
```

---

## âœ… 6. ì‹¤ë¬´ ë³´ì•ˆ íŒ ğŸ›¡ï¸

| í•­ëª© | ì„¤ëª… |
| --- | --- |
| ëª¨ë“  SQLì— PreparedStatement ì‚¬ìš© | SELECT, INSERT, UPDATE, DELETE ì „ë¶€ |
| ì…ë ¥ê°’ì€ í•­ìƒ ìœ íš¨ì„± ê²€ì‚¬ | ê¸¸ì´ ì œí•œ, ê³µë°± ì œê±°, null ì²´í¬ ë“± |
| DB ê³„ì •ì€ ìµœì†Œ ê¶Œí•œìœ¼ë¡œ ìƒì„± | SELECT/INSERTë§Œ í—ˆìš© (ê´€ë¦¬ì ê¶Œí•œ X) |
| ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ì‚¬ìš©ìì—ê²Œ ì§ì ‘ ë…¸ì¶œ ê¸ˆì§€ | e.printStackTrace()ëŠ” ë¡œê·¸ë¡œë§Œ ë‚¨ê¹€ |

---

## âœ… 7. ê¸°ìˆ  ë©´ì ‘ ëŒ€ë¹„ í•µì‹¬ ìš”ì•½ ğŸ’¬

| ì§ˆë¬¸ | ìš”ì  ì •ë¦¬ |
| --- | --- |
| SQL Injectionì´ë€? | ì‚¬ìš©ìê°€ SQL êµ¬ë¬¸ì„ ì¡°ì‘í•´ì„œ DBë¥¼ ê³µê²©í•˜ëŠ” ë°©ì‹ |
| ë°©ì§€ ë°©ë²•ì€? | PreparedStatement ì‚¬ìš©ìœ¼ë¡œ SQLê³¼ ê°’ì„ ë¶„ë¦¬ |
| Javaì—ì„œ ì…ë ¥ê°’ ê²€ì‚¬ ì˜ˆì‹œëŠ”? | `if(id == null |
| ì™œ JavaScriptë§Œìœ¼ë¡œëŠ” ì¶©ë¶„í•˜ì§€ ì•Šë‚˜ìš”? | êº¼ì§ˆ ìˆ˜ ìˆìŒ, ì„œë²„ì—ì„œëŠ” ë°˜ë“œì‹œ ë³´ì•ˆ ê²€ì‚¬ ìˆ˜í–‰ í•„ìš” |

---

## âœ… 8. ë§ˆë¬´ë¦¬ ìš”ì•½ ğŸ§ 

- ğŸš¨ SQL Injectionì€ ë³´ì•ˆ ì‚¬ê³  1ìˆœìœ„ â†’ ë°˜ë“œì‹œ ëŒ€ë¹„ í•„ìš”
- ğŸ” PreparedStatementëŠ” ê°€ì¥ ê¸°ë³¸ì´ì ê°•ë ¥í•œ ë°©ì–´ ìˆ˜ë‹¨
- ğŸ§¼ ì„œë²„ ìœ íš¨ì„± ê²€ì‚¬ë¡œ ì˜ëª»ëœ ì…ë ¥ ì°¨ë‹¨ (JSë§Œ ë¯¿ì§€ ë§ê¸°!)
- âœ… SQL + ì…ë ¥ê°’ì€ **ì ˆëŒ€ ì§ì ‘ ì—°ê²° X**, í•­ìƒ ë¶„ë¦¬í•´ì„œ ì²˜ë¦¬í•  ê²ƒ
